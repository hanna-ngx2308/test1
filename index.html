<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Du học sinh theo quốc gia (KR, 2024) — Interactive Viz</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background:#fafafa; color:#333; }
    header { padding:20px; background:#004477; color:#fff; }
    .container { max-width: 1100px; margin:0 auto; padding:20px; }
    h1 { margin:0; font-size:20px; }
    .panel { background:#fff; border:1px solid #ddd; border-radius:10px; padding:20px; margin-top:20px; }
    canvas { max-height:520px; }
    .controls { margin-top:15px; }
    textarea, select, input { width:100%; margin-top:8px; padding:8px; border:1px solid #ccc; border-radius:6px; }
    button { margin-top:10px; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; background:#004477; color:#fff; }
    button:hover { background:#0066aa; }
  </style>
</head>
<body>
  <header>
    <h1>2024 — Du học sinh tại Hàn theo quốc gia (Interactive)</h1>
  </header>

  <div class="container">
    <div class="panel">
      <label for="chartType">Dạng biểu đồ</label>
      <select id="chartType">
        <option value="doughnut">Doughnut</option>
        <option value="pie">Pie</option>
        <option value="bar">Bar (ngang)</option>
      </select>

      <label for="titleInput">Tiêu đề</label>
      <input id="titleInput" type="text" placeholder="Nhập tiêu đề..." />

      <button id="loadBtn">Nạp dữ liệu từ data.json</button>
    </div>

    <div class="panel">
      <h2 id="chartTitle">2024년 주요 국가별 외국인 유학생 현황</h2>
      <canvas id="chart"></canvas>
    </div>
  </div>

  <script>
  let DATA = [];
  let chart;

  async function loadData(){
    try{
      const res = await fetch('data.json');
      const json = await res.json();
      DATA = json;
      draw();
    }catch(e){
      alert('Không thể tải data.json: '+e.message);
    }
  }

  function colorsFrom(data){
    const palette = ['#f4b400','#1b6ddc','#b7d5ff','#ff4da6','#0f2b5f','#30c1cb','#9aa0aa'];
    return data.map((d,i)=> d.color || palette[i%palette.length]);
  }

  function makeConfig(type){
    const labels = DATA.map(d=>d.label);
    const values = DATA.map(d=>d.value);
    const colors = colorsFrom(DATA);
    const isBar = type === 'bar';
    return {
      type: isBar ? 'bar' : type,
      data: { labels, datasets:[{ data: values, backgroundColor: colors }] },
      options: {
        responsive:true, maintainAspectRatio:false,
        plugins:{ legend:{ display:!isBar } },
        scales: isBar ? { x:{beginAtZero:true} } : {}
      }
    }
  }

  function draw(){
    const ctx = document.getElementById('chart');
    if(chart){ chart.destroy(); }
    chart = new Chart(ctx, makeConfig(document.getElementById('chartType').value));
  }

  document.getElementById('loadBtn').addEventListener('click', loadData);
  document.getElementById('chartType').addEventListener('change', draw);
  document.getElementById('titleInput').addEventListener('input', e=>{
    document.getElementById('chartTitle').textContent = e.target.value || '2024년 주요 국가별 외국인 유학생 현황';
  });

  loadData();
  </script>
</body>
</html>
